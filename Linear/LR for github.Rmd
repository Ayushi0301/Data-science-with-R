---
title: "Linear Regression"
author: "Ayushi"
date: "27/10/2020"
output:
  html_document: default
  pdf_document: default
  word_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

### Linear Regression:
Linear Regression is a supervised machine learning algorithm. It establish relationship between continuous independent and continuous dependent variable.

![](E:/LR.png)

Image source:[link](https://www.javatpoint.com/linear-regression-in-machine-learning)

Linear regression performs the task to predict a dependent variable value (y) based on a given independent variable (x). So, this regression technique finds out a linear relationship between x (input) and y(output). Hence, the name is Linear Regression.

#### >**Linear regression implementation using R**
##### **Case Study:** *House Price Prediction*
> Import dataset

```{r read_data}
house<-read.csv("E:/Imarticus/R/house.csv")
head(house) 
```
> Check structure of data

```{r stucture}
str(house)
```
> Remove unwanted vaiables

```{r remove_var}
house$id<-NULL
house$date<-NULL
```
>Check summary of data

```{r su}
summary(house)
```
>Convert categorical variable into factor

```{r factor}
vect1<-c("bedrooms","floors","waterfront","view","condition","grade","zipcode")
house[,vect1]<-lapply(house[,vect1],factor)
str(house)
```
>Check any NA/blank value in data set, if present then impute

```{r impute}
colSums(is.na(house))

house$price[is.na(house$price)]<-median(house$price,na.rm = T)

house$sqft_lot[is.na(house$sqft_lot)]<-median(house$sqft_lot, na.rm = T)

summary(house$waterfront)
house$waterfront[is.na(house$waterfront)]<-"0"

summary(house$condition)
house$condition[is.na(house$condition)]<-"3"

summary(house$floors)
house$floors[is.na(house$floors)]<-"1"

colSums(is.na(house))
```
> Calculate count of years when house was build and renovated

```{r cal}
house$yr_built<-2020 - house$yr_built
house$yr_renovated<- 2020 - house$yr_renovated
house$yr_renovated[house$yr_renovated==2020]<-0
```
> Remove outliers from dependent variable  
Dependent variable : Price  
Create boxplot of price variable

```{r outlier}
boxplot(house$price)
#UW<-Q3+1.5*IQR
summary(house$price)#Q3=645000
UW<-645000+(1.5*(IQR(house$price)));UW
house_data<-subset(house,house$price<=UW)
head(house_data)
```
> Zipcode is factor variable but have more than 15 levels.  
Factor should consist of max 15 levels. Dropping Zipcode variable

```{r fact}
levels(house_data$zipcode)
house_data$zipcode<-NULL
```
> Reducing levels of bedroom

```{r out}
dim(house_data)
summary(house_data$bedrooms)
house_data$bedrooms<-as.numeric(house_data$bedrooms)
house_data<-subset(house_data,house_data$bedrooms<=6)
house_data$bedrooms<-as.factor(house_data$bedrooms)
```

> Cross validation  
Dividing data in 75-25[training(75)- testing(25)]

```{r part}
#install.packages("caret") ----install package if not installed
library(caret)
set.seed(123)
index<-createDataPartition(house_data$floors,p=0.75,list = F)
head(index)
training_house<-house_data[index,]
head(training_house)
testing_house<-house_data[-index,]
```
> Model selection method

```{r selection}
# full model
house_model_full<-lm(price~.,data = training_house)
summary(house_model_full)
# null model 
house_model_null<-lm(price~1,data = training_house)

# Stepwise forward regression
step(house_model_null,direction = "forward",
     scope = list(lower=house_model_null,upper=house_model_full))

#creating final model
house_model<-lm(formula = price ~ grade + lat + sqft_living + yr_built + view + 
    sqft_living15 + condition + floors + bathrooms + bedrooms + 
    sqft_lot + waterfront + sqft_lot15, data = training_house)

summary(house_model)
```
>check vif

```{r vif}
#install.packages("car") ----install package if not installed
library(car)
vif(house_model)
```

> Predicting house price of training data set using house_model

```{r pre}
training_house$pred_price<-predict(house_model,training_house)
head(training_house)
```
> Calculate RMSE (Root Mean Squared Error) of training data

```{r RMSE}
training_house$res<- residuals(house_model)
rmse_train<-sqrt(mean(training_house$res^2))
rmse_train
```
> Predicting house price of testing data set using house_model

```{r test_pred}
testing_house$pred_price<-predict(house_model,testing_house)
head(testing_house)
```
> Calculate RMSE (Root Mean Squared Error) of testing data

```{r RMSE_test}
testing_house$res<- testing_house$price - testing_house$pred_price
rmse_test<-sqrt(mean(testing_house$res^2))
rmse_test
```
> check difference between rmse_train and rmse_test  
The diff between rmse train and rmse test should not ecxeed by 15 %

```{r check}
diff_rmse<-rmse_train-rmse_test
diff_rmse
```
> durbinWatson Test

```{r dur}
library(car)
durbinWatsonTest(house_model)
```
